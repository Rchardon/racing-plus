import { EntityCollisionClass } from "isaac-typescript-definitions";
import { config } from "../../../modConfigMenu";

// ModCallbackCustom.POST_NPC_INIT_LATE
// EntityType.WIZOOB (219)
export function postNPCInitLateWizoob(npc: EntityNPC): void {
  if (!config.DisableInvulnerability) {
    return;
  }

  setGhostCollisionClass(npc);
}

// ModCallbackCustom.POST_NPC_INIT_LATE
// EntityType.THE_HAUNT (260)
// HauntVariant.LIL_HAUNT
export function postNPCInitLateLilHaunt(npc: EntityNPC): void {
  if (!config.DisableInvulnerability) {
    return;
  }

  setGhostCollisionClass(npc);
}

// ModCallbackCustom.POST_NPC_INIT_LATE
// EntityType.RED_GHOST (285)
export function postNPCInitLateRedGhost(npc: EntityNPC): void {
  if (!config.DisableInvulnerability) {
    return;
  }

  setGhostCollisionClass(npc);
}

/**
 * In vanilla, tears will pass through ghosts during their "Appear" animation, granting them
 * invulnerability. This is because the ghost is set to `EntityCollisionClass.NONE` when they spawn,
 * and then set to `EntityCollisionClass.PLAYER_OBJECTS` during their first reappearance.
 *
 * Fix the invulnerability by manually setting the `EntityCollisionClass`. This cannot be done in
 * the `POST_NPC_INIT` callback because setting the `EntityCollisionClass` there has no effect.
 */
function setGhostCollisionClass(npc: EntityNPC) {
  npc.EntityCollisionClass = EntityCollisionClass.PLAYER_OBJECTS;
}
