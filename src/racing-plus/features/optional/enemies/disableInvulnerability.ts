import { config } from "../../../modConfigMenu";

// ModCallbacks.MC_NPC_UPDATE (0)
// EntityType.ENTITY_WIZOOB (219)
// EntityType.ENTITY_THE_HAUNT (260)
// EntityType.ENTITY_RED_GHOST (285)
export function postNPCUpdateGhosts(npc: EntityNPC): void {
  setGhostCollisionClass(npc);
}

function setGhostCollisionClass(npc: EntityNPC) {
  if (!config.disableInvulnerability) {
    return;
  }

  // If this is a Haunt type, we only want to target Lil' Haunts
  if (npc.Type === EntityType.ENTITY_THE_HAUNT && npc.Variant !== 10) {
    return;
  }

  // In vanilla, tears will pass through the Wizoobs & Red Ghosts during their "Appear" animation,
  // granting them invulnerability
  // This is because the ghost is set to EntityCollisionClass.ENTCOLL_NONE when they spawn, and then
  // set to EntityCollisionClass.ENTCOLL_PLAYEROBJECTS during their first reappearance
  // Fix the invulnerability by manually setting the EntityCollisionClass
  // This cannot be done in the PostNPCInit callback because setting the EntityCollisionClass there
  // has no effect
  if (npc.FrameCount === 0) {
    npc.EntityCollisionClass = EntityCollisionClass.ENTCOLL_PLAYEROBJECTS;
  }
}
